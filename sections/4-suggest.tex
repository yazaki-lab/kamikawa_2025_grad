%%%%%%%%%% 実装に関して %%%%%%%%%%
\section{提案手法}

\subsection{提案手法の概要}
本研究では，エンタープライズ無線LAN環境における通信品質の改善を目的として，ネットワーク管理側の制御のみに依存するのではなく，利用者自身の能動的な行動変容を促すことにより，通信環境全体の最適化を図るユーザ行動支援手法を提案する．
近年，オフィスビルや大学キャンパスなどのエンタープライズ環境では，無線LANが業務や学習を支える基盤インフラとして広く利用されている一方で，利用者数や端末数の増加に伴い，通信品質のばらつきやスループット低下が問題となっている．

従来の無線LAN管理における最適化アプローチは，主にアクセスポイント（AP）の設置位置の最適化，チャネル割り当ての調整，送信出力制御といった，管理者主導の技術的施策に焦点が当てられてきた．
これらの手法は，静的あるいは準静的な環境を前提とした場合には有効であるものの，実際の運用環境では必ずしも十分な効果を発揮しない場合が多い．

その要因として，建物構造による電波の遮蔽や反射，不特定多数のユーザによる予測困難な移動，さらには来訪者が持ち込むモバイルルータやテザリング端末といった管理外の通信端末による干渉など，時間的・空間的に変動する要素が挙げられる．
これらの動的な要因を，管理者側の制御のみでリアルタイムに把握し，完全に解決することは困難である．

そこで本研究では，通信システムを構成する重要な要素として「ユーザ」に着目し，ネットワーク側が把握可能な環境情報と，ユーザ自身が提供する情報を組み合わせることで，ユーザに対して適切な行動指針を提示する新たなアプローチを検討する．
具体的には，ネットワーク管理側から取得可能な情報に基づき，ユーザに対して最適な接続先APや，通信品質の向上が期待できる移動先を提示することで，高品質な通信体験の実現を目指す．

提案アルゴリズムの特徴を以下にまとめる．
\begin{itemize}
  \item APとユーザ間の距離に加え，チャネル使用率および接続ユーザ数を考慮したAP選択を行う点
  \item ユーザの許容移動距離および最低要求スループットを制約条件として明示的に導入している点
  \item 新規ユーザ単体ではなく，システム全体のスループット最大化を目的としている点
\end{itemize}

これにより，実環境における電波干渉や負荷の偏りを考慮した，現実的かつ合理的なAP選択および移動誘導が可能となる．

\subsection{提案アルゴリズム}

本研究では，エンタープライズ無線LAN環境において新たに接続を行う利用者に対し，通信品質の向上を目的として，最適なアクセスポイント（AP）および移動方向を提示するアルゴリズムを提案する．
提案手法は，APと利用者端末の距離に基づいて接続先を決定する従来手法を拡張し，APが使用しているチャネルの使用率や接続ユーザ数といった無線環境の混雑状況を考慮する点に特徴がある．
本研究では，通信品質（QoE）の評価指標としてスループットを採用し，新規ユーザの接続によってシステム全体のスループットが最大化されることを目的とする．

\subsubsection{入力情報と前提条件}

提案アルゴリズムは，新規ユーザ$u$に対して以下の情報が与えられていることを前提とする．また，無線LAN環境内に存在するAPの集合を$A$とし，各AP $a \in A$に対して以下の情報が既知であると仮定する．
表\ref{tab:input_info}に入力情報の一覧を示す．

\begin{table}[h]
\centering
\caption{提案アルゴリズムの入力情報}
\label{tab:input_info}
\begin{tabular}{l|l|l}
\hline
カテゴリ & パラメータ & 説明 \\ \hline \hline
\multirow{3}{*}{ユーザ情報} 
  & $P_u$ & 現在位置 \\
  & $d_{th}$ & 許容最大移動距離 \\
  & $\theta_{th}$ & 最低要求スループット \\ \hline
\multirow{4}{*}{AP情報}
  & $P_a$ & APの位置座標 \\
  & $n_a$ & 接続中のユーザ数 \\
  & $U_c$ & 使用チャネルの使用率 \\
  & $\theta^{before}_a$ & 接続前の平均スループット \\ \hline
\end{tabular}
\end{table}

なお，本研究では位置情報の取得方法や入力インタフェースについては議論せず，ユーザが自己申告により現在位置を入力できるものと仮定する．

\subsubsection{接続候補APの抽出}

新規ユーザが移動可能な範囲内に存在するAPのみを接続候補として抽出する．
ユーザの移動は移動ベクトル$m$により表され，移動後のユーザ位置は$P_u - m$とする．
このとき，移動後のユーザとAP $a$との距離$d_{u,a}$は以下の式で定義される．

\begin{equation}
d_{u,a} = \left| P_a - (P_u - m) \right|
\end{equation}

距離$d_{u,a}$が許容最大移動距離$d_{th}$以下となるAPの集合を，接続候補AP集合$A_{cand}$とする．

\subsubsection{接続前後のスループット推定}

次に，各接続候補APに対して，新規ユーザ接続前後のスループットを推定する．
AP $a$に接続されている既存ユーザの平均スループット$\theta^{before}_a$は，接続ユーザのスループットの調和平均として与えられているものとする．

新規ユーザがAP $a$に接続した場合のスループット$\theta^{after}_{a,m}$は，APとユーザ間の距離およびチャネル使用率$U_c$を考慮して推定される．
このとき，新規ユーザのスループットが最低要求スループット$\theta_{th}$を下回る場合，または移動距離が許容最大移動距離$d_{th}$を超える場合には，当該APを接続候補から除外する．

\subsubsection{評価スコアの算出}

残った接続候補APに対して，以下の4つの評価指標を用いて総合スコアを算出する．
\begin{enumerate}
  \item 接続後スループットに基づくスループットスコア
  \item ユーザとAPの距離に基づく距離スコア
  \item APが使用するチャネルの使用率に基づくチャネル使用率スコア
  \item APに接続されているユーザ数に基づく接続ユーザ数スコア
\end{enumerate}

各スコアは正規化された値として算出され，重み係数$w_i$を用いて以下の式により総合スコア$Score(a)$を計算する．

\begin{equation}
Score(a) = \sum_i w_i \cdot score_i(a)
\end{equation}

\subsubsection{最適APおよび移動ベクトルの決定}

提案アルゴリズムでは，総合スコアが最大となるAPを単純に選択するのではなく，総合スコア上位の複数APを候補として扱う．
その上で，各候補APに対して，新規ユーザ接続後のシステム全体のスループットを算出し，これが最大となるAP $a^*$と移動ベクトル$m^*$を最終的な出力とする．

システム全体のスループット$\Theta^{after}_{a,m}$は，以下の式で表される．

\begin{equation}
\Theta^{after}_{a,m}
= \theta^{after}_{a,m} + \sum_{i \neq a} \theta^{before}_i
\end{equation}

以上で述べた提案アルゴリズムを擬似コードとしてAlgorithm\ref{alg:optimalAP}にまとめる．
%
\begin{algorithm}[tbh]
    \begin{algorithmic}[1]
        \State \textbf{Input:} $P_u$（ユーザ位置）, $d_{th}$（移動閾値）, $\theta_{th}$（スループット閾値）, $A$（AP集合）
        \State \textbf{Output:} $a^*$（最適AP）, $m^*$（最適移動ベクトル）

        \Statex
        \State
        \State $A_{cand} \gets \{a \in A | d_{u,a} \leq d_{th}\}$ where $d_{u,a} = |P_a - (P_u - m)|$ \Comment{式(1)(2)}

        \Statex
        \State
        \For{each $a \in A_{cand}$}
            \State $\theta_a^{before} \gets n_a / \sum_{i=1}^{n_a} (1/b_{i,a})$ \Comment{式(3)}
            \State $\theta_{a,m}^{after} \gets (n_a + 1) / (n_a/\theta_a^{before} + 1/b_{new,a})$ \Comment{式(4)}
            \If{$\theta_{new,a} < \theta_{th}$ or $|m| > d_{th}$} \Comment{式(5)による判定}
                \State $A_{cand} \gets A_{cand} \setminus \{a\}$
            \EndIf
        \EndFor

        \Statex
        \State
        \For{each $a \in A_{cand}$}
            \State $score_{\theta_a} \gets (\theta_{a,m}^{after} - \theta_{min}) / (\theta_{\max} - \theta_{min})$ \Comment{式(6)}
            \State $score_{d_{u,a}} \gets 1 - (d_{u,a} - d_{min}) / (d_{th} - d_{min})$ \Comment{式(7)}
            \State $score_{U_c} \gets (1-U_c)$, $score_{n_a} \gets 1-(n_a / n_{\max})$ \Comment{式(8)(9)}
            \State $Score(a) \gets \sum_i w_i \cdot score_i(a)$ \Comment{式(10)}
        \EndFor

        \Statex
        \State
        \State $A_{cand}' \gets \text{top-3 APs by } Score(a)$ \Comment{式(11)}
        \State $\{a^*, m^*\} \gets \arg\max_{(a,m), a \in A_{cand}'} \theta_{a,m}^{after}$ \Comment{式(12)}
        \State \Return $\{a^*, m^*\}$
    \end{algorithmic}
    \caption{提案アルゴリズム}
    \label{alg:optimalAP}
\end{algorithm}

\subsection{チャネル使用率の推定}

提案アルゴリズムでは，AP選択の評価指標の一つとしてチャネル使用率を用いる．
チャネル使用率は，IEEE 802.11k規格においてBSS Load要素として定義されており，多くの商用APから定期的にビーコンフレーム内で広報される情報である．
しかしながら，一部のAPやネットワーク構成においては，この情報が提供されない場合や，取得が困難な場合が存在する．
そのため，本研究の提案手法の適用範囲を拡大し，より汎用的なシステムとして実装するためには，チャネル使用率を直接取得できない環境においても，
他の観測可能なパラメータから間接的にチャネル使用率を推定する手法が必要となる．

本節では，シミュレーション環境における評価を想定し，RSSI，ユーザの通信帯域幅，およびAP接続ユーザ数といった容易に取得可能なパラメータを用いて，チャネル使用率を推定する手法を提案する．

\subsubsection{推定手法の方針}

チャネル使用率は，無線チャネルが実際に通信に使用されている時間の割合を表す指標であり，以下の要因によって変動する．
\begin{itemize}
  \item 接続ユーザ数：ユーザ数が多いほど，チャネルへのアクセス競合が増加し，使用率が上昇する
  \item 通信帯域幅：各ユーザが要求する帯域幅が大きいほど，チャネル占有時間が増加する
  \item 伝搬環境：APとユーザ間の距離や障害物により，RSSI（受信信号強度）が変化し，これが再送制御やMCS（Modulation and Coding Scheme）選択に影響を与える
\end{itemize}

これらの要因を踏まえ，本研究ではRSSI，通信帯域幅，ユーザ数の3つのパラメータを説明変数として，チャネル使用率を目的変数とする回帰モデルを構築する．

\subsubsection{データ収集と回帰分析}

チャネル使用率推定モデルの構築には，以下の手順を用いた．

\paragraph{シミュレーション条件の設定}
ネットワークシミュレータを用いて，ユーザ数，各ユーザの通信帯域幅，およびAPとユーザ間の距離をパラメータとして変化させた複数のシミュレーションを実施した．
具体的には，以下の条件を組み合わせた実験を行った．
\begin{itemize}
  \item ユーザ数：$n = \{1, 2, 3, \ldots, N_{max}\}$
  \item 通信帯域幅：$B = \{B_1, B_2, \ldots, B_k\}$ [Mbps]
  \item APとユーザ間距離：$d = \{d_1, d_2, \ldots, d_l\}$ [m]
\end{itemize}

各条件の組み合わせについて，シミュレーション実行中に真のチャネル使用率$U_c$を測定し，同時にRSSI値を記録した．

\paragraph{回帰モデルの導出}
収集したデータセット$\{(RSSI_i, B_i, n_i, U_{c,i})\}_{i=1}^{M}$に対して，最小二乗法による多変量回帰分析を実施した．
チャネル使用率$\hat{U}_c$を推定する回帰式は，以下の形式で表される．

\begin{equation}
\hat{U}_c = \beta_0 + \beta_1 \cdot RSSI + \beta_2 \cdot B + \beta_3 \cdot n + \epsilon
\end{equation}

ここで，$\beta_0, \beta_1, \beta_2, \beta_3$は回帰係数，$\epsilon$は誤差項である．
回帰係数は，観測データに対する残差平方和を最小化するように決定される．

必要に応じて，パラメータ間の相互作用項や非線形項（例：$RSSI^2$，$n \cdot B$）を導入することで，推定精度の向上を図ることも可能である．

\paragraph{推定式の検証}
導出した回帰式の妥当性を評価するため，訓練データとは異なるテストデータに対して推定を行い，真の値との決定係数$R^2$や平均二乗誤差（RMSE）を算出した．
推定精度が十分に高いことを確認した上で，シミュレーション評価において本推定式を適用する．

\subsubsection{シミュレーションへの適用}

提案手法の性能評価を行うシミュレーションにおいては，各時刻における各APのチャネル使用率を，導出した回帰式を用いてリアルタイムに推定する．
具体的には，シミュレーション内で観測可能なRSSI，各ユーザの通信帯域幅，およびAP接続ユーザ数を入力として，推定式$\hat{U}_c$によりチャネル使用率を算出する．
この推定値を提案アルゴリズムの評価スコア算出に利用することで，チャネル使用率情報が直接取得できない環境においても，提案手法の有効性を評価することが可能となる．

\subsubsection{推定手法の意義と限界}

本推定手法により，シミュレーション環境においても現実的なチャネル使用率の評価が可能となり，提案アルゴリズムの性能検証をより現実に即した条件で実施できる．
また，実環境への適用を考えた場合においても，BSS Load要素を広報しないAPが存在する環境や，クライアント側からの観測のみでシステムを構築する必要がある場合には，本推定手法が有用となる．

一方で，本推定手法はシミュレーション環境において収集したデータに基づいているため，実環境における電波伝搬特性の複雑さや，干渉源の影響，MACプロトコルの詳細な挙動などを完全には反映できない可能性がある．
実環境への適用にあたっては，実測データを用いた回帰モデルの再学習や，機械学習手法の導入による推定精度の向上が今後の課題として挙げられる．

